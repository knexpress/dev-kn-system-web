BACKEND IMPLEMENTATION PROMPT: Search Bookings by AWB Number

## Overview
Implement a backend endpoint to search bookings in the bookings collection by AWB number. This endpoint will be used by the frontend to search for bookings when users type in the AWB search field.

## Endpoint Specification

### GET /api/bookings/search-awb

**Query Parameters:**
- `awb` (string, required): The AWB number to search for (case-insensitive partial match)

**Response Format:**
```json
{
  "success": true,
  "data": [
    {
      "_id": "booking_id",
      "awb": "AESY532AKLUUZEZ3V",
      "tracking_code": "AESY532AKLUUZEZ3V",
      "awb_number": "AESY532AKLUUZEZ3V",
      "customer_name": "John Doe",
      "receiver_name": "Jane Smith",
      "origin_place": "Dubai",
      "destination_place": "Manila",
      "status": "CONFIRMED",
      "createdAt": "2024-01-01T00:00:00.000Z",
      "updatedAt": "2024-01-01T00:00:00.000Z",
      // ... other booking fields
    }
  ]
}
```

**Error Response:**
```json
{
  "success": false,
  "error": "Error message"
}
```

## Implementation Requirements

1. **Search Logic:**
   - Search should be case-insensitive
   - Support partial matching (if user types "AESY", it should find "AESY532AKLUUZEZ3V")
   - Search in the following fields (in order of priority):
     - `awb` (primary field)
     - `tracking_code`
     - `awb_number`
   - If multiple fields exist, prioritize exact matches in `awb` field

2. **Query Implementation:**
   - Use MongoDB query with `$or` operator to search across multiple fields
   - Use case-insensitive regex for partial matching
   - Example MongoDB query structure:
     ```javascript
     {
       $or: [
         { awb: { $regex: searchTerm, $options: 'i' } },
         { tracking_code: { $regex: searchTerm, $options: 'i' } },
         { awb_number: { $regex: searchTerm, $options: 'i' } }
       ]
     }
     ```

3. **Response Limit:**
   - Limit results to maximum 50 bookings to prevent performance issues
   - Sort results by relevance (exact matches first, then partial matches)
   - If possible, prioritize bookings with exact `awb` field matches

4. **Performance Considerations:**
   - Consider adding indexes on `awb`, `tracking_code`, and `awb_number` fields for faster searches
   - Use MongoDB text indexes if available for better search performance
   - Implement pagination if needed (though frontend currently expects all results)

5. **Authentication:**
   - Endpoint should require authentication (Bearer token)
   - Verify user has permission to search bookings

6. **Error Handling:**
   - Return appropriate error messages for invalid requests
   - Handle database errors gracefully
   - Return empty array if no bookings found (not an error)

## Example Implementation (Node.js/Express)

```javascript
// Route handler
router.get('/search-awb', authenticate, async (req, res) => {
  try {
    const { awb } = req.query;
    
    if (!awb || !awb.trim()) {
      return res.status(400).json({
        success: false,
        error: 'AWB number is required'
      });
    }

    const searchTerm = awb.trim();
    
    // Build search query
    const query = {
      $or: [
        { awb: { $regex: searchTerm, $options: 'i' } },
        { tracking_code: { $regex: searchTerm, $options: 'i' } },
        { awb_number: { $regex: searchTerm, $options: 'i' } }
      ]
    };

    // Search bookings
    const bookings = await Booking.find(query)
      .limit(50)
      .sort({ 
        // Prioritize exact matches in awb field
        awb: 1,
        createdAt: -1 
      })
      .lean();

    return res.json({
      success: true,
      data: bookings
    });
  } catch (error) {
    console.error('Error searching bookings by AWB:', error);
    return res.status(500).json({
      success: false,
      error: 'Failed to search bookings'
    });
  }
});
```

## Database Indexes

Add the following indexes to improve search performance:

```javascript
// MongoDB indexes
db.bookings.createIndex({ awb: 1 });
db.bookings.createIndex({ tracking_code: 1 });
db.bookings.createIndex({ awb_number: 1 });

// Or create a text index for full-text search
db.bookings.createIndex({ 
  awb: "text", 
  tracking_code: "text", 
  awb_number: "text" 
});
```

## Testing

Test cases to verify:
1. Search with exact AWB match
2. Search with partial AWB match
3. Search with case variations (uppercase, lowercase, mixed)
4. Search with non-existent AWB (should return empty array)
5. Search with empty string (should return error)
6. Search with special characters (should handle gracefully)
7. Verify authentication is required
8. Verify response limit (max 50 results)

## Notes

- The frontend expects the response to be an array of booking objects
- The frontend will use this to filter invoice requests that match the found bookings
- Consider caching frequent searches if performance becomes an issue
- The search should be fast enough for real-time autocomplete (debounced on frontend)

